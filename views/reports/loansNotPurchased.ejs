<div class="container">
<h1>Loans Not Purchased as of: <%= date %></h1>

<table class="table">
  <tr>
    <th>Investor</th>
    <th>Investor #</th>
    <th>Loan #</th>
    <th>Borrower Name</th>
    <th class="text-center">Loan Amount</th>
    <th>Processor</th>
    <th>Loan Officer</th>
    <th class="text-center">Funded Date</th>
    <th class="text-center">Days Out</th>
  </tr>

  <% var loanAmtTotal = parseFloat(0.00); %>

  <% for( var i = 0; i < loans.length; i++ ) { %>
    <script> console.log("<%= typeof loans[i].fundedDate %>");</script>
  <tr>
    <td><%= loans[i].investor %></td>
    <td><%= loans[i].investorNum %></td>
    <td><%= loans[i].loanNum %></td>
    <td><%= loans[i].b1_lname + ", " + loans[i].b1_fname %></td>
    <td class="text-center"><%= loans[i].loanAmt %></td>
    <% loanAmtTotal += parseFloat(loans[i].loanAmt.replace(/[$,]/g, "") )  %>
    <td><%= loans[i].processor %></td>
    <td><%= loans[i].loanOfficer %></td>
    <td class="text-center"><%= dateToFormattedString(loans[i].fundedDate) %></td>
    <td class="text-center"><%= Math.floor(Math.abs(new Date() - loans[i].fundedDate)/1000/60/60/24) %></td>
  </tr>
  <% } %>

  <tr>
    <th></th>
    <th></th>
    <th></th>
    <th>Count: <%= loans.length %></th>

    <th>Total: <%= "$" + loanAmtTotal.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,") %></th>
    <th></th>
    <th></th>
    <th></th>
    <th></th>
  </tr>

</table>
</container>

<script type="text/javascript">
<%
function dateToFormattedString(date){
  var mm = date.getMonth() + 1;
  var dd = date.getDate();
  if(dd < 10){
    dd = '0' + dd;
  }
  var yyyy = date.getFullYear().toString().substring(2);
  return mm + "/" + dd + "/" + yyyy;
}
%>
</script>
